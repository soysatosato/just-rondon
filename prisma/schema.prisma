generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Profile {
  id              String            @id @default(uuid())
  clerkId         String            @unique
  username        String            @unique
  email           String
  profileImage    String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  bookings        Booking[]
  hasVisited      hasVisited[]
}

model Museum {
  id             String           @id @default(uuid())
  name           String           @unique
  slug           String           @unique
  tagline        String?
  category       String?          @default("museum")
  description    String?
  price          Float
  address        String
  lat            Float
  lng            Float
  image          String
  website        String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  tourPrice      Float
  highlights     String[]
  recommendLevel Int?             @default(0)
  engName        String?
  isForChildren  Boolean          @default(false)
  summary        String?
  blurb          String?
  artworks       Artwork[]
  bookings       Booking[]
  exhibition     Exhibition[]
  museumInfo     MuseumInfo?
  openingHours   OpeningHours[]
  trivia         Trivia[]
  hasVisited     hasVisited[]
}

model Artwork {
  id             String            @id @default(uuid())
  title          String
  artist         String?
  year           String?
  location       String?
  description    String?
  isOnDisplay    Boolean           @default(true)
  museumId       String            @default("6cc90107-59e4-45a8-b901-abb9748ebeea")
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  image          String?
  room           String?
  mustSee        Boolean
  recommendLevel Int               @default(0)
  highlights     String[]
  engTitle       String?
  museum         Museum            @relation(fields: [museumId], references: [id])
}

model hasVisited {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  profileId String
  museumId  String
  museum    Museum   @relation(fields: [museumId], references: [id], onDelete: Cascade)
  profile   Profile  @relation(fields: [profileId], references: [clerkId], onDelete: Cascade)
}

model Booking {
  id            String   @id @default(uuid())
  tourDate      DateTime
  numGuests     Int
  paymentStatus Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  profileId     String
  museumId      String
  museum        Museum   @relation(fields: [museumId], references: [id], onDelete: Cascade)
  profile       Profile  @relation(fields: [profileId], references: [clerkId], onDelete: Cascade)
}

model OpeningHours {
  id        String  @id @default(uuid())
  museumId  String
  dayOfWeek String
  openTime  String?
  closeTime String?
  museum    Museum  @relation(fields: [museumId], references: [id])

  @@unique([museumId, dayOfWeek])
}

model Exhibition {
  id          String   @id @default(cuid())
  museumId    String
  name        String
  description String
  startDate   DateTime
  endDate     DateTime
  admission   Float
  Museum      Museum   @relation(fields: [museumId], references: [id])
}

model Trivia {
  id       String @id @default(cuid())
  museumId String
  title    String
  content  String
  Museum   Museum @relation(fields: [museumId], references: [id])
}

model MuseumInfo {
  id                    String   @id @default(cuid())
  museumId              String   @unique
  photographyAllowed    String?
  reservationRequired   Boolean?
  cloakroomInfo         String?
  nearestStation        String?
  stationWalkingMinutes Int?
  nearestBusStop        String?
  busStopWalkingMinutes Int?
  guidedTourAvailable   Boolean?
  guidedTourLanguages   String?
  cafeteriaAvailable    Boolean?
  shopAvailable         Boolean?
  wifiAvailable         Boolean?
  website               String?
  admissionFeeAdult     Float?
  admissionFeeStudent   Float?
  admissionFeeChild     Float?
  recommendedDuration   Int?
  guidedTourFee         Float?
  museum                Museum   @relation(fields: [museumId], references: [id])
}

model News {
  id          String   @id @default(cuid())
  title       String
  content     String
  category    String
  tags        String[]
  views_count Int      @default(0)
  image       String   @default("/news-bg.JPG")
  summary     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Musical {
  id             String   @id @default(uuid())
  name           String
  engName        String
  slug           String   @unique
  tagline        String?
  description    String
  summary        String
  blurb          String?
  highlights     String[]
  theatreName    String
  address        String
  lat            Float
  lng            Float
  image          String
  website        String
  isOnShow       Boolean
  recommendLevel Int      @default(0)
  mustSee        Boolean
  original       String   @default("")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  songs          Song[]
}

model Song {
  id        String   @id @default(cuid())
  name      String
  artist    String
  lyrics    String
  scene     String
  musicalId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  index     Int
  youtubeId String?
  musical   Musical  @relation(fields: [musicalId], references: [id])
}

model Post {
  id           String    @id @default(cuid())
  category     String    @default("none")
  author       String
  deletePsswrd String    @default("0000")
  title        String
  content      String
  votes        Int       @default(0)
  views        Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  ip           String?
  sessionId    String?
  userAgent    String?
  comments     Comment[]
}

model Comment {
  id        String    @id @default(cuid())
  postId    String
  parentId  String?
  author    String
  content   String
  votes     Int       @default(0)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  ip        String?
  sessionId String?
  userAgent String?
  parent    Comment?  @relation("CommentToChildren", fields: [parentId], references: [id])
  children  Comment[] @relation("CommentToChildren")
  post      Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model Contact {
  id        String  @id @default(cuid())
  email     String
  token     String  @unique
  message   String
  name      String
  confirmed Boolean @default(false)
}

model Attraction {
  id           String     @id @default(uuid())
  name         String     @unique
  engName      String?    
  slug         String     @unique
  tagline      String?
  summary  String?
  address      String
  lat          Float
  lng          Float
  image        String
  website      String?
  recommendLevel  Int?      @default(0)
  mustSee      Boolean    @default(false)
  isForKids      Boolean    @default(false)
  isFree      Boolean    @default(false)
  category     String    @default("")

  sections     AttractionSection[]

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model AttractionSection {
  id            Int       @id @default(autoincrement())
  title         String
  description   String?
  displayOrder  Int

  attractionId  String
  attraction    Attraction @relation(fields: [attractionId], references: [id])

  createdAt     DateTime @default(now())
  }

  model Content {
  id String  @id @default(cuid())
  title     String
  engTitle     String?
  slug      String    
  summary   String
  mainText  String?
  image        String?
  website      String?
  category     String    @default("")
  createdAt DateTime         @default(now())

  sections  ContentSection[]
}

model ContentSection {
  id            Int       @id @default(autoincrement())
  title         String
  description   String?
  displayOrder  Int @default(0)
  image         String?

  contentId  String
  content    Content @relation(fields: [contentId], references: [id])

  createdAt     DateTime @default(now())
  }

  model Lyrics {
  id         String    @id @default(cuid())
  name       String
  artistId   String
  artist     Artist    @relation(fields: [artistId], references: [id])
  lyrics     String
  scene      String?
  album      String?
  youtubeId  String?
  views      Int      @default(0)
  genre      String?
  year       Int     @default(0)
  month      Int     @default(0)
  albumOrder Int     @default(0)
  
  createdAt  DateTime  @default(now())

  rankings    Ranking[]
}

model Artist {
  id        String   @id @default(cuid())
  name      String
  engName   String
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isHot    Boolean?

  songs     Lyrics[]
  rankings  Ranking[]
}

model Ranking {
  id          String       @id @default(cuid())
  type        RankingType
  rank        Int
  album       String?
  periodStart DateTime
  periodEnd   DateTime

  // Song と Artist どちらのランキングにも使える構造
  lyricsId    String?
  lyrics      Lyrics?     @relation(fields: [lyricsId], references: [id])
  artistId  String?
  artist    Artist?   @relation(fields: [artistId], references: [id])

  @@index([type, periodEnd])
}
enum RankingType {
  HOT_SONGS
  HOT_ALBUM
  HOT_ARTISTS
}



model LyricsRequest {
  id        Int      @id @default(autoincrement())
  title     String
  artist    String?
  createdAt DateTime @default(now())
}

model ServiceCharge {
  id                     String   @id
  placeId                String
  storeName              String
  storeAddress           String
  lat                    Float
  lng                    Float
  borough                String?
  postcode               String?

  // ===== MVP =====
  serviceChargeCollected Boolean
  distributionType       String?
  amountPeriod           String?
  amountValue            Float?

  // ===== サービスチャージ専用の自由記述 =====
  serviceChargeComment   String?

  // ===== Phase2: 賄い・生活 =====
  mealCountPerDay        String?   // "0" | "1" | "2plus"
  mealRestrictions       String[] // ["no-beef", "no-meat", "no-fish", "none"]
  mealComment       String? // ["no-beef", "no-meat", "no-fish", "none"]
  mealDrink              String?   // "alcohol-ok" | "softdrinks" | "water-only" | "none"

  shiftSchedule          String?   // "monthly" | "weekly" | "last-minute"
  visaSupport            String?   // "yes" | "no" | "unknown"

  // ===== 職場環境 =====
  workAtmosphere         String?   // "good" | "neutral" | "tense" | "toxic"
  managementPresence     String?   // "owner-daily" | "manager-daily" | "sometimes" | "hands-off"

  ethnicityRatio         String?   // 選択肢のみ（自由記述なし）

  // ===== 全体の自由記述 =====
  generalComment         String?

  createdAt              DateTime @default(now())

  @@index([placeId])
  @@index([serviceChargeCollected])
}

